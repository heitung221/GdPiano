<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>GdPiano - To play music funnier and easier than ever before</title>
	
	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
	<link rel="stylesheet" href="https://cdn.rawgit.com/necolas/normalize.css/master/normalize.css">
	<link rel="stylesheet" href="https://cdn.rawgit.com/milligram/milligram/master/dist/milligram.min.css">
    <style>
		#content {
			width: 800px;
			margin: auto;
			}
        body {
			font-size: 22px;
            }	
		p {
			width: 500;
			word-wrap: break-word;
			}
		form {
			width: 300px;
			margin: left;
			}
		button {
			font-size: 14px;
			}
    </style>
</head>
	
<body>
<div id="content">
	<br>
	<p> Welcome to GdPiano, a simple and fun music instrument played with relative pitch.<br>
	</p>
	
	
		<form>
			<div id="textOfSelectKey">Select Key:</div>
			<select id="selectKey">
				<option id = "Key0" value = "0">C Major / A Minor</option>
				<option id = "Key1" value = "1">C# Major / A# Minor</option>
				<option id = "Key2" value = "2">D Major / B Minor</option>
				<option id = "Key3" value = "3">D# Major / C Minor</option>
				<option id = "Key4" value = "4">E Major / C# Minor</option>
				<option id = "Key5" value = "5">F Major / D Minor</option>
				<option id = "Key6" value = "6">F# Major / D# Minor</option>
				<option id = "Key7" value = "7">G Major / E Minor</option>
				<option id = "Key8" value = "8">G# Major / F Minor</option>
				<option id = "Key9" value = "9">A Major / F# Minor</option>
				<option id = "Key10" value = "10">A# Major / G Minor</option>
				<option id = "Key11" value = "11">B Major / G# Minor</option>
			</select>
		</form>
		<br>
	
		<form>
			Select Key Layout:
			<select id="selectTone">	
				<option id = "Tone1" value = 1>Middle Tone Range</option>
				<option id = "Tone2" value = 2>High Tone Range</option>
				<option id = "Tone3" value = 3>Low Tone Range</option>
				<option id = "ChordMode" value = 4>Piano-like Layout Mode</option>
			<!--	<option id = "ATone1" value = 11>Middle Tone Range (Auto-play chord)</option>
				<option id = "ATone2" value = 12>High Tone Range (Auto-play chord)</option>
				<option id = "ATone3" value = 13>Low Tone Range (Auto-play chord)</option> !-->
			</select>
		</form>
		<br>
	<p id="tutorial">Press A to play Do, press S to play Re, press D to play Mi, and etc. Press Shift + A to play the key between Do and Re, press Shift + S to play the key between Re and Mi, and etc. </p>
	<br><br><br>
	<button id="NormalMode">Normal Mode</button>
	<button id="JyutKukMode">粵曲模式</button>
	
</div>

</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	
<script>
	
$(document).ready(function(){
	
	var allowed = true;
	
	var sources = ["notes/C2.mp3", "notes/Db2.mp3", "notes/D2.mp3", "notes/Eb2.mp3", "notes/E2.mp3", "notes/F2.mp3", "notes/Gb2.mp3", "notes/G2.mp3", "notes/Ab2.mp3", "notes/A2.mp3", "notes/Bb2.mp3", "notes/B2.mp3", "notes/C3.mp3", "notes/Db3.mp3", "notes/D3.mp3", "notes/Eb3.mp3", "notes/E3.mp3", "notes/F3.mp3", "notes/Gb3.mp3", "notes/G3.mp3", "notes/Ab3.mp3", "notes/A3.mp3", "notes/Bb3.mp3", "notes/B3.mp3", "notes/C4.mp3", "notes/Db4.mp3", "notes/D4.mp3", "notes/Eb4.mp3", "notes/E4.mp3", "notes/F4.mp3", "notes/Gb4.mp3", "notes/G4.mp3", "notes/Ab4.mp3", "notes/A4.mp3", "notes/Bb4.mp3", "notes/B4.mp3", "notes/C5.mp3", "notes/Db5.mp3", "notes/D5.mp3", "notes/Eb5.mp3", "notes/E5.mp3", "notes/F5.mp3", "notes/Gb5.mp3", "notes/G5.mp3", "notes/Ab5.mp3", "notes/A5.mp3", "notes/Bb5.mp3", "notes/B5.mp3", "notes/C6.mp3", "notes/Db6.mp3", "notes/D6.mp3", "notes/Eb6.mp3", "notes/E6.mp3", "notes/F6.mp3", "notes/Gb6.mp3", "notes/G6.mp3", "notes/Ab6.mp3", "notes/A6.mp3", "notes/Bb6.mp3", "notes/B6.mp3", "notes/C7.mp3"];
	
	$(document).keydown(keyPush);
	$("#selectKey").change(keyPush);
	$("#selectTone").change(keyPush);	
	
	//copy for solving keydown many times
	$(document).keyup(function(e) {
		allowed = true;
		});
	$(document).focus(function(e) { 
		allowed = true;
		});
	//end of copy for solving keydown many times
	
	
	function keyPush(evt){
	
		var selectkey = $("#selectKey").val();
		var key = Number(selectkey);
		var selectTone = $("#selectTone").val();
		var Layout = Number(selectTone);
		$(this).blur();
		
		//assign key and tone
		if (Layout == 1 || Layout == 4 || Layout == 11){
					Dol = key + 13 - 1;
				}
			
		if (Layout == 2 || Layout == 12){
					Dol = key + 25 - 1;
				}
			
		if (Layout == 3 || Layout == 13){
					Dol = key + 1 - 1;
				}
		
		//copy for solving keydown many times
		if (event.repeat != undefined) {
			allowed = !event.repeat;
			}
		if (!allowed) return;
		allowed = false;
		//end of copy for solving keydown many times	
		//reference: https://stackoverflow.com/questions/7686197/how-can-i-avoid-autorepeated-keydown-events-in-javascript
		
		
		//start of pressing key
		function play(inputNumber){
				var au = Dol + inputNumber;
				var sound = new Audio(sources[au]);
				sound.play();	
			}
			
		if (Layout == 1 || Layout == 2 || Layout == 3){
			if (evt.shiftKey == false){
				if (evt.keyCode == 81)	play(0);
				if (evt.keyCode == 87)	play(2);
				if (evt.keyCode == 69)	play(4);
				if (evt.keyCode == 82)	play(5);
				if (evt.keyCode == 84)	play(7);
				if (evt.keyCode == 89)	play(9);
				if (evt.keyCode == 85)	play(11);
				if (evt.keyCode == 65)	play(12);
				if (evt.keyCode == 83)	play(14);
				if (evt.keyCode == 68)	play(16);
				if (evt.keyCode == 70)	play(17);
				if (evt.keyCode == 71)	play(19);
				if (evt.keyCode == 72)	play(21);
				if (evt.keyCode == 74)	play(23);
				if (evt.keyCode == 90)	play(24);
				if (evt.keyCode == 88)	play(26);
				if (evt.keyCode == 67)	play(28);
				if (evt.keyCode == 86)	play(29);
				if (evt.keyCode == 66)	play(31);
				if (evt.keyCode == 78)	play(33);
				if (evt.keyCode == 77)	play(35);
				if (evt.keyCode == 17)	{
					var sound = new Audio("notes/C4.mp3");
					sound.play();
					}
				}
			if (evt.shiftKey == true){
				if (evt.keyCode == 81)	play(1);
				if (evt.keyCode == 87)	play(3);
				if (evt.keyCode == 82)	play(6);
				if (evt.keyCode == 84)	play(8);
				if (evt.keyCode == 89)	play(10);
				if (evt.keyCode == 65)	play(13);
				if (evt.keyCode == 83)	play(15);
				if (evt.keyCode == 70)	play(18);
				if (evt.keyCode == 71)	play(20);
				if (evt.keyCode == 72)	play(22);
				if (evt.keyCode == 90)	play(25);
				if (evt.keyCode == 88)	play(27);
				if (evt.keyCode == 86)	play(30);
				if (evt.keyCode == 66)	play(32);
				if (evt.keyCode == 78)	play(34);
				if (evt.keyCode == 77)	play(36);
				}
				$("#tutorial").text("Press A to play Do, press S to play Re, press D to play Mi, and etc. Press Shift + A to play the key between Do and Re, press Shift + S to play the key between Re and Mi, and etc.");
			}
			
		if (Layout == 4){
				if (evt.keyCode == 65)	play(12);
				if (evt.keyCode == 87)	play(13);
				if (evt.keyCode == 83)	play(14);
				if (evt.keyCode == 69)	play(15);
				if (evt.keyCode == 68)	play(16);
				if (evt.keyCode == 70)	play(17);
				if (evt.keyCode == 84)	play(18);
				if (evt.keyCode == 71)	play(19);
				if (evt.keyCode == 89)	play(20);
				if (evt.keyCode == 72)	play(21);
				if (evt.keyCode == 85)	play(22);
				if (evt.keyCode == 74)	play(23);
				if (evt.keyCode == 75)	play(24);
				if (evt.keyCode == 79)	play(25);
				if (evt.keyCode == 76)	play(26);
				if (evt.keyCode == 80)	play(27);
				if (evt.keyCode == 186)	play(28);
				if (evt.keyCode == 222)	play(29);
				$("#tutorial").text("A is Do, S is Re, D is Mi, F is Fa, G is So, and etc. W is the key between Do and Re (Di), E is the key between Re and Mi (Ri), and etc.");
			}
		
		console.log(evt.keyCode);
		//end of pressing key
		
		};
	
	});
	
</script>

<script>
	$("#NormalMode").click(function(){
		$("#textOfSelectKey").text("Select Key");
		$("#Key0").text("C Major / A Minor");
		$("#Key5").text("F Major / D Minor");
		$("#Key7").text("G Major / E Minor");
		$("#Key8").text("G# Major / F Minor");
		$("#Key10").text("A# Major / G Minor");	
	});
	
	$("#JyutKukMode").click(function(){
		$("#textOfSelectKey").text("調式");
		$("#Key0").text("正線 / 合尺線");
		$("#Key5").text("尺五線");
		$("#Key7").text("反線 / 上六線");
		$("#Key8").text("乙反線");
		$("#Key10").text("士工線");	
	});
</script>	
	
</html>